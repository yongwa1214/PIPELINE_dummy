<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.pipeline_dummy.application.game.GameMapper">
<!-- 활성화 된 게임리스트    -->
    <select id="findByStatus">
        SELECT game_id
        FROM game
        WHERE STATUS = 'ST-ACT'
    </select>

    <select id="findGameIds">
        SELECT game_id
        FROM game
        WHERE STATUS = 'ST-ACT'
        AND base_game_id IS NULL
    </select>

    <select id="findAllGameIds">
        SELECT game_id
        FROM game
        WHERE STATUS = 'ST-ACT'
    </select>

    <!-- 국기에 따른 게임 가격  -->
    <select id="findGamePrice">
        SELECT price_amount
        FROM regional_price
        WHERE country_code = #{countryCode} AND game_id IN
        <foreach collection="gameList" item="id" open="(" separator="," close=")">
            #{id.gameId}
        </foreach>
    </select>

    <!-- 할인율 및 할인 아이디 들고오기   -->
    <select id="findDiscount">
        SELECT
        g.game_id,
        COALESCE(d.discount_rate, 0) AS discount_rate,
        d.discount_id
        FROM game g
        LEFT JOIN discount d
        ON g.game_id = d.game_id
        AND d.event_id IN (
            SELECT event_id
            FROM event
            WHERE #{date} BETWEEN started_at AND ended_at
        )
        WHERE g.game_id IN
        <foreach collection="gameList" item="id" open="(" separator="," close=")">
            #{id.gameId}
        </foreach>;
    </select>
</mapper>