<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.pipeline_dummy.application.library.LibraryMapper">

    <select id="findMissingBaseGames">
        SELECT g.base_game_id
        FROM game g
        LEFT JOIN purchase_item l
        ON g.base_game_id = l.game_id
        WHERE g.game_id IN
        <foreach collection="res" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
        AND l.game_id IS NULL
        AND g.base_game_id IS NOT NULL
    </select>

    <select id="findOwnGame">
        SELECT game_id
        FROM library l
        JOIN purchase_item PI
        ON l.item_id = PI.item_id
        WHERE l.owner_id = #{userId} AND lib_status != 'ST-RFND'
    </select>

    <insert id="addLibrary">
        INSERT INTO library
        (owner_id, item_id, lib_status, playtime, last_play, play_now, got_at)
        VALUES
        <foreach collection="res" item="item" separator=",">
            (
                #{item.ownerId},
                #{item.itemId},
                #{item.libStatus},
                #{item.playtime},
                #{item.lastPlay},
                #{item.playNow},
                #{item.gotAt}
            )
        </foreach>
    </insert>

    <select id="findLibraryIds">
        SELECT library_id
        FROM library
        WHERE owner_id = #{ownerId}
    </select>

    <select id="findLibrary">
        SELECT library_id
        FROM library
    </select>

</mapper>


